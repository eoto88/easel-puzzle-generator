<script src="http://d3js.org/d3.v3.min.js"></script>

<style>
  body {
    font: 13px sans-serif;
    width: 960px;
    height: 500px;
  }

  rect,
  circle,
  .line {
    fill: none;
    stroke: steelblue;
    stroke-width: 1.5px;
  }

  circle {
    fill: #fff;
    fill-opacity: .2;
  }

</style>

<body>
</body>

<script>
  var width = 500, height = 500;

  var randomBetween = function(min, max) {
    return Math.random() * (max - min) + min;
  };

  var edgeDistributions = function() {
    var baselineOffsets = {
      xMin: 36,
      xMax: 48,
      yMin: -15,
      yMax: 5
    };

    var upperOffsets = {
      xMin: 30,
      yMin: 20,
      yMax: 48
    };

    var point1 = [0, 0];
    var point2 = [
      randomBetween(baselineOffsets.xMin, baselineOffsets.xMax),
      randomBetween(baselineOffsets.yMin, baselineOffsets.yMax)
    ];
    var point3 = [
      randomBetween(upperOffsets.xMin, point2[0]),
      randomBetween(upperOffsets.yMin, upperOffsets.yMax)
    ];
    var point4 = [
      randomBetween(100-baselineOffsets.xMax, 100-upperOffsets.xMin),
      randomBetween(upperOffsets.yMin, upperOffsets.yMax)
    ];
    var point5 = [
      randomBetween(100-baselineOffsets.xMax, point4[0]),
      randomBetween(baselineOffsets.yMin, baselineOffsets.yMax)
    ];
    var point6 = [100, 0];

    var sign = Math.random() < 0.5 ? -1 : 1;

    return [point1, point2, point3, point4, point5, point6].map(function(p) {
      return [p[0] / 100, p[1] * sign / 100];
    });
  };

  var line = d3.svg.line().interpolate("basis");

  var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height)
      .attr("tabindex", 1);

  svg.append("rect")
      .attr("width", width)
      .attr("height", height)

  var lines = [];

  var buildHorizontalLines = function() {
    var rowCount = 10;
    var rowHeight = height / rowCount;

    var columnCount = 10;
    var columnWidth = width / columnCount;

    for (var rowIndex=1; rowIndex < rowCount; rowIndex++) {
      for (var columnIndex=0; columnIndex < columnCount; columnIndex++) {
        var points = edgeDistributions();

        points = points.map(function(p) {
          var columnOffset = columnWidth * columnIndex;
          var x = p[0] * columnWidth + columnOffset;
          var rowOffset = rowHeight * rowIndex;
          var y = height - (p[1] * rowHeight + rowOffset);

          return [x, y];
        });

        lines.push(points);
      }
    }
  };
  buildHorizontalLines();

  var buildVerticalLines = function() {
    var rowCount = 10;
    var rowHeight = height / rowCount;

    var columnCount = 10;
    var columnWidth = width / columnCount;

    for (var columnIndex=1; columnIndex < columnCount; columnIndex++) {
      for (var rowIndex=0; rowIndex < rowCount; rowIndex++) {
        var points = edgeDistributions();

        points = points.map(function(p) {
          var columnOffset = columnWidth * columnIndex;
          var x = p[1] * columnWidth + columnOffset;
          var rowOffset = rowHeight * rowIndex;
          var y = height - (p[0] * rowHeight + rowOffset);

          return [x, y];
        });

        lines.push(points);
      }
    }
  };
  buildVerticalLines();

  var lineData = svg.selectAll("path").data(lines);

  lineData.enter().append("path")
        .attr("class", "line")
        .call(redraw);

  function redraw() {
    svg.selectAll("path").attr("d", line);

    if (d3.event) {
      d3.event.preventDefault();
      d3.event.stopPropagation();
    }
  }
</script>
